machine:
  xcode:
    version: "6.3.1"
  environment:
    LC_CTYPE: en_US.UTF-8

dependencies:
  override:
    - sudo chown :wheel "/Library/Developer/CoreSimulator/Profiles/Runtimes/iOS 7.1.simruntime/Contents/Resources/RuntimeRoot/usr/lib/dyld_sim"
    - sudo chown :wheel "/Library/Developer/CoreSimulator/Profiles/Runtimes/iOS 8.1.simruntime/Contents/Resources/RuntimeRoot/usr/lib/dyld_sim"
    - sudo chown :wheel "/Library/Developer/CoreSimulator/Profiles/Runtimes/iOS 8.2.simruntime/Contents/Resources/RuntimeRoot/usr/lib/dyld_sim"
    - ./script/import-certificates
    - sudo gem install cocoapods
    - sudo gem install xcpretty
    - brew update
    - brew install carthage
    - carthage bootstrap

test:
  override:
    - carthage build --no-skip-current
    - pod lib lint
    - set -o pipefail && xcodebuild test -scheme APIKit-iOS | xcpretty -c -r junit -o $CIRCLE_TEST_REPORTS/test-report-ios.xml
    - set -o pipefail && xcodebuild test -scheme APIKit-Mac | xcpretty -c -r junit -o $CIRCLE_TEST_REPORTS/test-report-mac.xml
    - set -o pipefail && xcodebuild build -scheme DemoApp -sdk iphonesimulator | xcpretty -c
